# 광고 시스템 문제 해결 가이드

## 🎯 문제 원인 분석

프로덕션 환경에서 광고가 표시되지 않는 **주된 원인**은 환경 변수 설정 문제입니다:

### 환경 변수 문제
- `.env.local` 파일에 `NEXT_PUBLIC_IS_DEV_MODE=true`가 설정되어 있음
- 이로 인해 프로덕션에서도 실제 데이터베이스 대신 목(mock) 데이터를 사용
- 목 데이터는 개발용으로만 설계되어 실제 광고 관리 시스템과 연동되지 않음

### 시스템 상태 확인
✅ **정상 작동하는 부분들**:
- PageLayout 컴포넌트가 이미 TopCarouselAd와 BottomBannerAd를 통합 완료
- 구인구직(`/jobs`)과 커뮤니티(`/community`) 페이지가 PageLayout 사용 중
- 광고 관리 시스템(`/admin/advertisements`) 완전 구현
- 데이터베이스 스키마와 CRUD 기능 완성
- useAds 훅 로직 완전 구현

## 🔧 해결 방법

### 1. 즉시 해결 (프로덕션 배포)

**가장 중요한 단계**: 프로덕션 환경에서 다음 중 하나를 적용

```bash
# 옵션 1: 환경 변수 제거 (권장)
# 프로덕션 배포 시 NEXT_PUBLIC_IS_DEV_MODE 변수를 아예 설정하지 않음

# 옵션 2: false로 설정
NEXT_PUBLIC_IS_DEV_MODE=false

# 옵션 3: .env.production 파일 사용
# .env.production 파일을 생성하고 개발 모드 변수를 제외
```

### 2. 초기 광고 데이터 설정

프로덕션 데이터베이스에 초기 광고 데이터를 설정하려면:

```bash
# 제공된 스크립트 실행
node scripts/setup-initial-ads.js
```

**또는** 관리자 페이지에서 수동 생성:
1. `/admin/advertisements`에서 광고 생성
2. 캐러셀 광고 3개, 배너 광고 1개 권장
3. 이미지 규격: 캐러셀 1200x400px, 배너 1200x200px

### 3. 광고 설정 확인

`/admin/advertisements/settings`에서 다음 설정 확인:
- ✅ **상단 캐러셀 표시**: 활성화
- ✅ **하단 배너 표시**: 활성화
- ✅ **자동 재생**: 활성화 (권장)
- ⚙️ **재생 간격**: 5000ms (기본값)

## 📋 단계별 검증 방법

### 1단계: 환경 변수 확인
```javascript
// 브라우저 개발자 도구 콘솔에서 실행
console.log('Environment check:', {
  isDevMode: process.env.NEXT_PUBLIC_IS_DEV_MODE,
  expected: 'undefined or false'
})
```

### 2단계: useAds 훅 디버깅
이제 useAds 훅에 디버깅 로그가 추가되었습니다:
- 🔍 환경 설정 로그
- 💾 데이터베이스 로딩 로그  
- 📊 광고 데이터 결과 로그
- 🎠 처리된 광고 수량 로그

### 3단계: 페이지별 광고 표시 확인
- `/jobs` - 구인구직 페이지 상단/하단 광고
- `/community` - 커뮤니티 페이지 상단/하단 광고
- 관리자는 `/admin/advertisements`에서 클릭/조회 수 확인 가능

## 🚀 배포 시 체크리스트

### 프로덕션 배포 전 필수 확인사항:
- [ ] `NEXT_PUBLIC_IS_DEV_MODE` 변수가 true로 설정되지 않음
- [ ] 데이터베이스에 활성화된 광고가 존재
- [ ] 광고 설정에서 캐러셀/배너 표시가 활성화됨
- [ ] 이미지 URL이 접근 가능한 상태
- [ ] 관리자 권한으로 광고 관리 페이지 접근 가능

### 배포 후 확인사항:
- [ ] `/jobs` 페이지에서 광고 표시 확인
- [ ] `/community` 페이지에서 광고 표시 확인
- [ ] 브라우저 개발자 도구에서 useAds 디버깅 로그 확인
- [ ] 광고 클릭 시 올바른 링크로 이동 확인
- [ ] 관리자 페이지에서 클릭/조회 수 증가 확인

## ⚡ 빠른 해결책

**지금 당장 프로덕션에서 광고를 보고 싶다면:**

1. 프로덕션 환경 변수에서 `NEXT_PUBLIC_IS_DEV_MODE=true` 제거
2. 애플리케이션 재배포
3. 관리자 페이지에서 광고 1개 이상 생성하고 활성화
4. `/jobs` 또는 `/community` 페이지 새로고침

## 🔍 문제가 지속될 경우

만약 위 단계를 모두 수행했는데도 광고가 보이지 않는다면:

1. 브라우저 개발자 도구 콘솔에서 useAds 로그 확인
2. Network 탭에서 Supabase API 호출 상태 확인  
3. `/admin/advertisements`에서 광고 데이터 상태 확인
4. Database 연결 상태 및 RLS 정책 확인

## 📝 추가 기능

현재 구현된 고급 기능들:
- 🎯 **클릭/조회 추적**: 광고별 성과 측정
- 📅 **일정 관리**: 시작일/종료일 기반 자동 활성화/비활성화
- 🎨 **반응형 디자인**: 모바일/태블릿/데스크톱 최적화
- ⚙️ **관리자 설정**: 글로벌 광고 표시 설정
- 📊 **분석 대시보드**: 광고 성과 분석

이 가이드를 따라하면 프로덕션에서 광고가 정상적으로 표시될 것입니다.